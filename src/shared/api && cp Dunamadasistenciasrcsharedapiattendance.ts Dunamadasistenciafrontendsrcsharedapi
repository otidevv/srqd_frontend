/**
 * Workers API
 * Handles CRUD operations for workers
 */

import { apiClient } from "./client";
import type {
  Worker,
  CreateWorkerDTO,
  UpdateWorkerDTO,
} from "@/entities/worker";

export interface GetWorkersParams {
  page?: number;
  limit?: number;
  search?: string;
  contractType?: string;
  department?: string;
  status?: string;
}

export interface PaginatedResponse<T> {
  data: T[];
  total: number;
  page: number;
  limit: number;
  totalPages: number;
}

export const workersApi = {
  /**
   * Get all workers with optional filtering and pagination
   */
  getWorkers: async (
    params?: GetWorkersParams
  ): Promise<PaginatedResponse<Worker>> => {
    const queryParams = new URLSearchParams();
    if (params?.page) queryParams.set("page", params.page.toString());
    if (params?.limit) queryParams.set("limit", params.limit.toString());
    if (params?.search) queryParams.set("search", params.search);
    if (params?.contractType) queryParams.set("contractType", params.contractType);
    if (params?.department) queryParams.set("department", params.department);
    if (params?.status) queryParams.set("status", params.status);

    const query = queryParams.toString();
    return apiClient.get<PaginatedResponse<Worker>>(
      `/workers${query ? `?${query}` : ""}`
    );
  },

  /**
   * Get single worker by ID
   */
  getWorker: async (id: string): Promise<Worker> => {
    return apiClient.get<Worker>(`/workers/${id}`);
  },

  /**
   * Create new worker
   */
  createWorker: async (data: CreateWorkerDTO): Promise<Worker> => {
    return apiClient.post<Worker>("/workers", data);
  },

  /**
   * Update existing worker
   */
  updateWorker: async (id: string, data: UpdateWorkerDTO): Promise<Worker> => {
    return apiClient.patch<Worker>(`/workers/${id}`, data);
  },

  /**
   * Delete worker
   */
  deleteWorker: async (id: string): Promise<void> => {
    return apiClient.delete<void>(`/workers/${id}`);
  },

  /**
   * Sync worker with ZKTeco device
   */
  syncToDevice: async (
    workerId: string,
    deviceId: string
  ): Promise<{ success: boolean; deviceUserId: string }> => {
    return apiClient.post<{ success: boolean; deviceUserId: string }>(
      `/workers/${workerId}/sync-device`,
      { deviceId }
    );
  },
};
